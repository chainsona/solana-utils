<!doctype html>
<html lang="en" class="antialiased">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>PDA Finder — Solana Utils</title>
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        theme: {
          fontFamily: {
            sans: ["Inter", "sans-serif"],
            mono: ["JetBrains Mono", "monospace"],
          },
          extend: {
            colors: {
              background: "#0f172a",
              surface: "#1e293b",
              border: "#334155",
              primary: "#8b5cf6",
              accent: "#10b981",
            },
          },
        },
      };
    </script>
    <style>
      body {
        background-color: theme("colors.background");
        color: #f1f5f9;
        background-image: radial-gradient(
          circle at 50% 0%,
          #1e293b 0%,
          #0f172a 70%
        );
        min-height: 100vh;
      }
      .mono-box {
        font-family: "JetBrains Mono", monospace;
      }
      .input-area {
        background: #020617;
        border: 1px solid theme("colors.border");
        border-radius: 8px;
        color: #e2e8f0;
        transition: all 0.2s ease;
      }
      .input-area:focus {
        border-color: theme("colors.primary");
        outline: none;
      }
      .btn {
        transition: all 0.2s;
        border-radius: 8px;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      .btn:active {
        transform: scale(0.98);
      }
    </style>
  </head>
  <body class="py-6 px-4 flex flex-col items-center">
    <header class="w-full max-w-3xl flex justify-between items-center mb-10">
      <div class="flex items-center gap-3">
        <a
          href="/"
          class="w-10 h-10 bg-slate-800 hover:bg-slate-700 rounded-xl flex items-center justify-center transition-colors"
        >
          <iconify-icon
            icon="lucide:arrow-left"
            width="20"
            class="text-slate-400"
          ></iconify-icon>
        </a>
        <div>
          <h1 class="text-xl font-bold tracking-tight text-white">
            PDA Finder
          </h1>
          <p class="text-xs text-slate-400 font-medium">PROGRAM DERIVED ADDRESS</p>
        </div>
      </div>
    </header>

    <main class="w-full max-w-3xl space-y-8">
      <!-- Input Section -->
      <section class="bg-slate-800/50 border border-slate-700 rounded-xl p-6">
        <div class="space-y-6">
          <div class="space-y-2">
            <label class="text-xs font-semibold text-slate-400 uppercase"
              >Program ID</label
            >
            <input
              type="text"
              id="programId"
              class="input-area w-full p-3 text-sm mono-box"
              placeholder="TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"
            />
          </div>

          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <label class="text-xs font-semibold text-slate-400 uppercase"
                >Seeds</label
              >
              <button
                id="addSeedBtn"
                class="text-xs text-violet-400 hover:text-violet-300 flex items-center gap-1 font-medium"
              >
                <iconify-icon icon="lucide:plus"></iconify-icon> Add Seed
              </button>
            </div>
            <div id="seedsContainer" class="space-y-3">
              <!-- Seed Items will be added here -->
            </div>
          </div>

          <button
            id="findBtn"
            class="btn w-full bg-violet-600 hover:bg-violet-500 text-white py-3 shadow-lg shadow-violet-500/20"
          >
            Find Address
          </button>
        </div>
      </section>

      <!-- Result Section -->
      <section
        id="resultSection"
        class="hidden bg-slate-800/50 border border-slate-700 rounded-xl p-6 animate-fade-in"
      >
        <div class="space-y-6">
          <div class="space-y-2">
            <div class="flex justify-between items-end">
              <label class="text-xs font-semibold text-slate-400 uppercase"
                >PDA Address</label
              >
              <button
                class="copy-btn text-xs text-slate-400 hover:text-white flex items-center gap-1"
                data-target="pdaAddress"
              >
                <iconify-icon icon="lucide:copy" width="14"></iconify-icon> Copy
              </button>
            </div>
            <div
              id="pdaAddress"
              class="mono-box input-area p-4 text-sm text-emerald-400 break-all bg-emerald-950/10 border-emerald-500/20"
            ></div>
          </div>

          <div class="space-y-2">
            <label class="text-xs font-semibold text-slate-400 uppercase"
              >Bump Seed</label
            >
            <div
              id="bumpSeed"
              class="mono-box input-area p-3 text-sm text-amber-400 w-20 text-center bg-amber-950/10 border-amber-500/20"
            ></div>
          </div>
        </div>
      </section>
    </main>

    <footer class="mt-auto py-8 text-center text-slate-600 text-[10px] font-bold tracking-widest uppercase">
      <p>Soona • No Server Data</p>
    </footer>

    <!-- Template for Seed Row -->
    <template id="seedRowTemplate">
      <div class="flex gap-2 items-start seed-row">
        <select
          class="seed-type input-area p-2.5 text-xs w-24 shrink-0 focus:ring-0"
        >
          <option value="string">String</option>
          <option value="pubkey">Pubkey</option>
          <option value="u8">u8</option>
          <option value="u64">u64 (LE)</option>
        </select>
        <input
          type="text"
          class="seed-value input-area flex-1 p-2.5 text-sm mono-box"
          placeholder="Value"
        />
        <button
          class="remove-seed btn w-9 h-9 text-slate-500 hover:text-red-400 hover:bg-slate-700/50 shrink-0"
        >
          <iconify-icon icon="lucide:trash-2" width="16"></iconify-icon>
        </button>
      </div>
    </template>

    <script type="module">
      import { PublicKey } from "https://esm.sh/@solana/web3.js@1.98.0";
      import * as buffer from "https://esm.sh/buffer@6.0.3";
      window.Buffer = buffer.Buffer;
      import BN from "https://esm.sh/bn.js@5.2.1";

      const container = document.getElementById("seedsContainer");
      const template = document.getElementById("seedRowTemplate");

      // Add initial seed
      addSeedRow();

      document
        .getElementById("addSeedBtn")
        .addEventListener("click", () => addSeedRow());

      function addSeedRow() {
        const clone = template.content.cloneNode(true);
        const row = clone.querySelector(".seed-row");
        
        row.querySelector(".remove-seed").addEventListener("click", () => {
          if (container.children.length > 1) row.remove();
        });

        // Dynamic placeholder
        const select = row.querySelector("select");
        const input = row.querySelector("input");
        select.addEventListener("change", (e) => {
            switch(e.target.value) {
                case 'string': input.placeholder = "metadata"; break;
                case 'pubkey': input.placeholder = "Address..."; break;
                case 'u8': input.placeholder = "255"; break;
                case 'u64': input.placeholder = "1000000"; break;
            }
        });

        container.appendChild(clone);
      }

      document.getElementById("findBtn").addEventListener("click", () => {
        try {
          const programIdStr = document
            .getElementById("programId")
            .value.trim();
          if (!programIdStr) throw new Error("Program ID required");

          const programId = new PublicKey(programIdStr);
          const seeds = [];
          const rows = document.querySelectorAll(".seed-row");

          rows.forEach((row) => {
            const type = row.querySelector(".seed-type").value;
            const val = row.querySelector(".seed-value").value.trim();
            if (!val) return; // Skip empty seeds? Or throw?

            switch (type) {
              case "string":
                seeds.push(Buffer.from(val, "utf-8"));
                break;
              case "pubkey":
                seeds.push(new PublicKey(val).toBuffer());
                break;
              case "u8":
                seeds.push(Buffer.from([parseInt(val)]));
                break;
              case "u64":
                seeds.push(new BN(val).toArrayLike(Buffer, "le", 8));
                break;
            }
          });

          const [pda, bump] = PublicKey.findProgramAddressSync(
            seeds,
            programId,
          );

          document.getElementById("pdaAddress").textContent = pda.toBase58();
          document.getElementById("bumpSeed").textContent = bump;
          document.getElementById("resultSection").classList.remove("hidden");
        } catch (e) {
          alert("Error: " + e.message);
        }
      });

      // Copy logic
      document.addEventListener("click", (e) => {
        const btn = e.target.closest(".copy-btn");
        if(btn) {
            const text = document.getElementById(btn.dataset.target).textContent;
            navigator.clipboard.writeText(text);
            const original = btn.innerHTML;
            btn.innerHTML = `<iconify-icon icon="lucide:check" width="14"></iconify-icon> Copied`;
            setTimeout(() => btn.innerHTML = original, 1500);
        }
      });
    </script>
  </body>
</html>

